import java.util.ArrayList;
import java.util.Scanner;
import java.util.regex.Pattern;

public class TiendasEFEV3 {
    // Datos del usuario
    private static String emailGuardado, passwordGuardado;
    private static String nombreGuardado, apellidosGuardados, dniGuardado, celularGuardado;

    // Productos y carrito
    static ArrayList<Producto> productos = new ArrayList<>();
    static ArrayList<Producto> carrito = new ArrayList<>();
    
    static Scanner sc = new Scanner(System.in);

    public static void main(String[] args) {
        // Productos predeterminados
        productos.add(new Producto("LG", "TwinWash", 22, 3299));
        productos.add(new Producto("Samsung", "Ecobubble", 20, 2899));
        productos.add(new Producto("Mabe", "AquaSaver", 19, 1899));

        int opcion;
        do {
            System.out.println("\n--- BIENVENIDO A TIENDAS EFE ---");
            System.out.println("1. Registro de Usuario");
            System.out.println("2. Iniciar Sesi√≥n");
            System.out.println("3. Ver Productos Disponibles");
            System.out.println("4. Buscar Productos");
            System.out.println("5. Agregar al Carrito");
            System.out.println("6. Ver Carrito");
            System.out.println("7. Procesar Pedido");
            System.out.println("8. Seleccionar M√©todo de Pago");
            System.out.println("9. Generar Comprobante");
            System.out.println("10. Salir del Sistema");
            System.out.print("Seleccione una opci√≥n: ");
            opcion = sc.nextInt();
            sc.nextLine();

            switch(opcion) {
                case 1: registrarUsuario(); break;
                case 2: if (iniciarSesion()) System.out.println("Inicio de sesi√≥n exitoso."); break;
                case 3: mostrarProductos(); break;
                case 4: buscarProducto(); break;
                case 5: agregarCarrito(); break;
                case 6: verCarrito(); break;
                case 7: procesarPedido(); break;
                case 8: metodoPago(); break;
                case 9: generarComprobante(); break;
                case 10: System.out.println("Gracias por visitar Tiendas EFE. ¬°Hasta pronto!"); break;
                default: System.out.println("Opci√≥n inv√°lida.");
            }
        } while(opcion != 10);
    }

    // ================= AXCEL =================
    public static void registrarUsuario() {
        System.out.println("\n--- Registro de Usuario ---");
        System.out.print("Ingrese su nombre: ");
        nombreGuardado = sc.nextLine();
        System.out.print("Ingrese sus apellidos: ");
        apellidosGuardados = sc.nextLine();

        do {
            System.out.print("Ingrese su DNI (8 d√≠gitos): ");
            dniGuardado = sc.nextLine();
        } while (!dniGuardado.matches("\\d{8}"));

        do {
            System.out.print("Ingrese su celular (9 d√≠gitos): ");
            celularGuardado = sc.nextLine();
        } while (!celularGuardado.matches("\\d{9}"));

        do {
            System.out.print("Ingrese su correo: ");
            emailGuardado = sc.nextLine();
        } while (!emailGuardado.matches("^[\\w.-]+@[\\w.-]+\\.com$"));

        System.out.print("Ingrese su contrase√±a: ");
        passwordGuardado = sc.nextLine();
        System.out.println("‚úÖ Registro exitoso.");
    }

    public static boolean iniciarSesion() {
        System.out.println("\n--- Iniciar Sesi√≥n ---");
        int intentos = 0;
        while (intentos < 3) {
            System.out.print("Correo: ");
            String email = sc.nextLine();
            System.out.print("Contrase√±a: ");
            String pass = sc.nextLine();

            if (email.equals(emailGuardado) && pass.equals(passwordGuardado)) {
                return true;
            }
            intentos++;
            System.out.println("‚ùå Datos incorrectos. Intento " + intentos);
        }
        System.out.println("‚ùå Se agotaron los intentos.");
        return false;
    }

    // ================= ROMULO =================
    public static void mostrarProductos() {
        System.out.println("\n--- Productos Disponibles ---");
        for (int i = 0; i < productos.size(); i++) {
            System.out.println((i + 1) + ". " + productos.get(i));
        }
    }

    public static void buscarProducto() {
        System.out.println("\n--- Buscar Producto ---");
        System.out.print("Buscar por marca o capacidad: ");
        String criterio = sc.nextLine();

        for (Producto p : productos) {
            if (p.getMarca().equalsIgnoreCase(criterio) || String.valueOf(p.getCapacidad()).equals(criterio)) {
                System.out.println(p);
            }
        }
    }

    public static void agregarCarrito() {
        mostrarProductos();
        System.out.print("Ingrese el n√∫mero del producto a agregar al carrito: ");
        int num = sc.nextInt();
        sc.nextLine();
        if (num >= 1 && num <= productos.size()) {
            carrito.add(productos.get(num - 1));
            System.out.println("‚úÖ Producto agregado al carrito.");
        } else {
            System.out.println("‚ùå N√∫mero inv√°lido.");
        }
    }

    // ================= KENJI =================
    public static void verCarrito() {
        System.out.println("\n--- Carrito de Compras ---");
        if (carrito.isEmpty()) {
            System.out.println("üõí El carrito est√° vac√≠o.");
            return;
        }
        double total = 0;
        for (Producto p : carrito) {
            System.out.println(p);
            total += p.getPrecio();
        }
        System.out.println("üí∞ Total: S/. " + total);
    }

    public static void procesarPedido() {
        System.out.println("\n--- Procesar Pedido ---");
        if (carrito.isEmpty()) {
            System.out.println("‚ö†Ô∏è El carrito est√° vac√≠o.");
            return;
        }
        System.out.println("‚úÖ Pedido procesado con √©xito.");
    }

    // ================= PAUL =================
    public static void metodoPago() {
        System.out.println("\n--- M√©todo de Pago ---");
        System.out.print("Ingrese n√∫mero de tarjeta (16 d√≠gitos): ");
        String tarjeta = sc.nextLine();
        while (!tarjeta.matches("\\d{16}")) {
            System.out.print("‚ùå Inv√°lido. Intente otra vez: ");
            tarjeta = sc.nextLine();
        }

        System.out.print("Ingrese CVV (3 d√≠gitos): ");
        String cvv = sc.nextLine();
        while (!cvv.matches("\\d{3}")) {
            System.out.print("‚ùå CVV inv√°lido. Intente otra vez: ");
            cvv = sc.nextLine();
        }

        System.out.println("‚úÖ Pago validado correctamente.");
    }

    public static void generarComprobante() {
        System.out.println("\n--- Boleta de Venta ---");
        if (carrito.isEmpty()) {
            System.out.println("‚ö†Ô∏è No hay productos para generar boleta.");
            return;
        }

        double subtotal = 0;
        for (Producto p : carrito) {
            subtotal += p.getPrecio();
        }
        double igv = subtotal * 0.18;
        double total = subtotal + igv;

        System.out.println("Cliente: " + nombreGuardado + " " + apellidosGuardados);
        System.out.println("DNI: " + dniGuardado);
        System.out.println("\nDetalle de compra:");
        for (Producto p : carrito) {
            System.out.println(p);
        }
        System.out.println("\nSubtotal: S/. " + subtotal);
        System.out.println("IGV: S/. " + igv);
        System.out.println("Total a pagar: S/. " + total);
        System.out.println("‚úÖ ¬°Gracias por su compra!");
    }
}

// ================= Clase Producto =================
class Producto {
    private String marca;
    private String modelo;
    private int capacidad;
    private double precio;

    public Producto(String marca, String modelo, int capacidad, double precio) {
        this.marca = marca;
        this.modelo = modelo;
        this.capacidad = capacidad;
        this.precio = precio;
    }

    public String getMarca() { return marca; }
    public int getCapacidad() { return capacidad; }
    public double getPrecio() { return precio; }

    public String toString() {
        return "Marca: " + marca + " | Modelo: " + modelo + " | Capacidad: " + capacidad + "kg | Precio: S/. " + precio;
    }
}

